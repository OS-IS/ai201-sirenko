### 4.3.4 Тестування для перерахування облікових записів і вгадування облікових записів користувачів

ID  WSTG-IDNT-04

#### Резюме
Метою цього тесту є перевірка можливості зібрати набір дійсних імен користувачів шляхом взаємодії з механізмом автентифікації програми. Цей тест буде корисним для тестування грубої сили, під час якого тестер перевіряє, чи можливо знайти відповідний пароль за допомогою правильного імені користувача.

Часто веб-додатки виявляють наявність імені користувача в системі внаслідок неправильної конфігурації або дизайнерського рішення. Наприклад, іноді, коли ми надсилаємо неправильні облікові дані, ми отримуємо повідомлення про те, що або ім’я користувача присутнє в системі, або наданий пароль неправильний. Отримана інформація може бути використана зловмисником для отримання списку користувачів системи. Ця інформація може бути використана для атаки на веб-програму, наприклад, за допомогою грубої сили або атаки за замовчуванням на ім’я користувача та пароль.

Тестер повинен взаємодіяти з механізмом автентифікації програми, щоб зрозуміти, чи надсилання певних запитів призводить до того, що програма відповідає різними способами. Ця проблема існує через те, що інформація, видана веб-програмою або веб-сервером, коли користувач вводить дійсне ім’я користувача, відрізняється від інформації, яка використовується недійсним.

У деяких випадках надходить повідомлення, яке показує, чи надані облікові дані неправильні через використання недійсного імені користувача або пароля. Іноді тестери можуть перерахувати існуючих користувачів, надіславши ім’я користувача та порожній пароль.

#### Цілі тесту

- Перегляньте процеси, які стосуються ідентифікації користувача (наприклад, реєстрація, вхід тощо).
- Перерахуйте користувачів, де це можливо, шляхом аналізу відповідей.

#### Як тестувати

Під час тестування за допомогою чорної скриньки тестувальник нічого не знає про конкретну програму, ім’я користувача, логіку програми, повідомлення про помилки на сторінці входу чи засоби відновлення пароля. Якщо програма є вразливою, тестувальник отримує повідомлення-відповідь, яке прямо чи опосередковано розкриває деяку інформацію, корисну для перерахування користувачів.

##### Повідомлення відповіді HTTP
###### Тестування дійсних облікових даних

Запишіть відповідь сервера, коли ви подасте дійсний ідентифікатор користувача та дійсний пароль.

*Використовуючи веб-проксі, зверніть увагу на інформацію, отриману в результаті цієї успішної автентифікації (відповідь HTTP 200, довжина відповіді).*

##### Перевірка дійсного користувача з неправильним паролем

Тепер тестувальник повинен спробувати вставити дійсний ідентифікатор користувача та неправильний пароль і записати повідомлення про помилку, створене програмою.

*Браузер має відобразити повідомлення, подібне до такого:
Authentification failed*

*На відміну від будь-якого повідомлення, яке розкриває існування користувача, наприклад:*

`Login for User foo: invalid password`

*Використовуючи веб-проксі, зверніть увагу на інформацію, отриману під час цієї невдалої спроби автентифікації (відповідь HTTP 200, довжина відповіді).*

##### Перевірка на наявність неіснуючого імені користувача

Тепер тестувальник повинен спробувати вставити недійсний ідентифікатор користувача та неправильний пароль і записати відповідь сервера (тестер повинен бути впевнений, що ім’я користувача недійсне в програмі). Запишіть повідомлення про помилку та відповідь сервера.

*Якщо тестувальник вводить неіснуючий ідентифікатор користувача, він може отримати повідомлення, подібне до такого:
This user is not active*

*або таке повідомлення:*

`Login failed for User foo: invalid Account`

*Зазвичай програма має відповідати однаковим повідомленням про помилку та однаковою довжиною на різні неправильні запити. Якщо відповіді не однакові, тестувальник повинен дослідити та знайти ключ, який створює різницю між двома відповідями. Наприклад:*

1. Запит клієнта: дійсний користувач/неправильний пароль
2. Відповідь сервера: пароль неправильний
3. Запит клієнта: Неправильний користувач/неправильний пароль
4. Відповідь сервера: користувача не розпізнано

*Наведені вище відповіді дозволяють клієнту зрозуміти, що для першого запиту він має дійсне ім’я користувача. Тому вони можуть взаємодіяти з програмою, запитуючи набір можливих ідентифікаторів користувачів і спостерігаючи за відповіддю.*

*Дивлячись на відповідь другого сервера, тестувальник так само розуміє, що він не має дійсного імені користувача. Таким чином, вони можуть взаємодіяти таким же чином і створювати список дійсних ідентифікаторів користувачів, дивлячись на відповіді сервера.*

#### Інші способи перерахування користувачів

Тестувальники можуть перераховувати користувачів кількома способами, наприклад:

##### Аналіз коду помилки, отриманого на сторінках входу
Деякі веб-додатки видають певний код помилки або повідомлення, яке ми можемо проаналізувати.

##### Аналіз URL-адрес і переадресацій URL-адрес

Наприклад:
`
   -  http://www.foo.com/err.jsp?User=baduser&Error=0
   -  http://www.foo.com/err.jsp?User=gooduser&Error=2
`

Як видно вище, коли тестувальник надає ідентифікатор користувача та пароль веб-додатку, він бачить повідомлення про те, що в URL-адресі сталася помилка. У першому випадку вони надали неправильний ідентифікатор користувача та неправильний пароль. У другому — хороший ідентифікатор користувача та поганий пароль, щоб вони могли визначити дійсний ідентифікатор користувача.

##### Зондування URI

Іноді веб-сервер відповідає по-різному, отримує він запит щодо наявного каталогу чи ні. Наприклад, на деяких порталах кожен користувач асоціюється з каталогом. Якщо тестувальники спробують отримати доступ до існуючого каталогу, вони можуть отримати помилку веб-сервера.

Ось деякі з поширених помилок, отриманих від веб-серверів:

- 403 Forbidden error code
- 404 Not found error code

Наприклад:

`- http://www.foo.com/account1 - ми отримуємо з веб-сервера: 403 Forbidden
 - http://www.foo.com/account2 - отримуємо з веб-сервера: 404 file Not Found
`
У першому випадку користувач існує, але тестер не може переглянути веб-сторінку, у другому випадку натомість користувача “account2” не існує. Збираючи цю інформацію, тестувальники можуть перераховувати користувачів.

##### Аналіз заголовків веб-сторінок

Тестувальники можуть отримати корисну інформацію про заголовок веб-сторінки, де вони можуть отримати конкретний код помилки або повідомлення, які вказують, чи є проблеми з іменем користувача чи паролем.

Наприклад, якщо користувач не може пройти автентифікацію в програмі та отримує веб-сторінку, назва якої схожа на:
   -  Invalid user
   -  Invalid authentication

##### Аналіз повідомлення, отриманого від засобу відновлення

Коли ми використовуємо засіб відновлення (тобто функцію забутого пароля), уразлива програма може повернути повідомлення, яке показує, чи існує ім’я користувача чи ні.

Наприклад, такі повідомлення:

- Invalid username: email address is not valid or the specified user was not found.
- Valid username: Your password has been successfully sent to the email address you registered with.

##### Дружнє повідомлення про помилку 404

Коли ми запитуємо користувача в неіснуючому каталозі, ми не завжди отримуємо код помилки 404. Натомість ми можемо отримати «200 ok» із зображенням, у цьому випадку ми можемо припустити, що коли ми отримуємо конкретне зображення, користувача не існує. Цю логіку можна застосувати до відповіді іншого веб-сервера; хитрість полягає в хорошому аналізі повідомлень веб-сервера та веб-додатків.

##### Аналіз часу відповіді

Окрім перегляду змісту відповідей, також слід враховувати час, необхідний для відповіді. Зокрема, коли запит викликає взаємодію із зовнішньою службою (наприклад, надсилання електронного листа із забутим паролем), це може додати кілька сотень мілісекунд до відповіді, за якою можна визначити, чи дійсний запитуваний користувач.

##### Вгадування користувачів

У деяких випадках ідентифікатори користувачів створюються за допомогою спеціальних політик адміністратора або компанії. Наприклад, ми можемо переглянути користувача з ідентифікатором користувача, створеним у послідовному порядку:

    CN000100
    CN000101
    ...

Іноді імена користувачів створюються з псевдонімом REALM, а потім послідовними номерами:


   -  R1001 – user 001 for REALM1
   -  R2001 – user 001 for REALM2

У наведеному вище прикладі ми можемо створити прості сценарії оболонки, які створюють ідентифікатори користувачів і надсилають запит за допомогою такого інструменту, як wget, щоб автоматизувати веб-запит для визначення дійсних ідентифікаторів користувачів. Щоб створити сценарій, ми також можемо використовувати Perl і curl.

Інші можливості: - ідентифікатори користувачів, пов'язані з номерами кредитних карток, або загалом номери з шаблоном. - ідентифікатори користувачів, пов’язані зі справжніми іменами, напр. якщо Фредді Мерк’юрі має ідентифікатор користувача «fmercury», то ви можете припустити, що Роджер Тейлор має ідентифікатор користувача «rtaylor».

Знову ж таки, ми можемо вгадати ім’я користувача за інформацією, отриманою із запиту LDAP або зі збору інформації Google, наприклад, із певного домену. Google може допомогти знайти користувачів домену за допомогою конкретних запитів або за допомогою простого сценарію або інструменту оболонки.

*Перераховуючи облікові записи користувачів, ви ризикуєте заблокувати облікові записи після попередньо визначеної кількості невдалих перевірок (на основі політики програми). Крім того, іноді ваша IP-адреса може бути заборонена динамічними правилами брандмауера програми або системи запобігання вторгненням.*

#### Тестування сірого ящика
##### Тестування повідомлень про помилки автентифікації

Переконайтеся, що програма відповідає однаково на кожен запит клієнта, який призводить до невдалої автентифікації. Для цієї проблеми тестування чорної скриньки та тестування сірої скриньки мають ту саму концепцію, що базується на аналізі повідомлень або кодів помилок, отриманих із веб-програми.

*Програма повинна відповідати таким же чином на кожну невдалу спробу автентифікації. 
Наприклад: подані облікові дані недійсні*

### Санація
Переконайтеся, що програма повертає узгоджені загальні повідомлення про помилки у відповідь на недійсне ім’я облікового запису, пароль або інші облікові дані користувача, введені під час процесу входу.

Переконайтеся, що системні облікові записи за замовчуванням і тестові облікові записи видалено, перш ніж випускати систему в робочий режим (або відкривати її для ненадійної мережі).

### Інструменти

   -  [OWASP Zed Attack Proxy (ZAP)](https://www.zaproxy.org/)
   -  [curl](https://curl.haxx.se/)
   -  [PERL](https://www.perl.org/)

### Список літератури

 - [Marco Mella, Sun Java Access & Identity Manager Users enumeration](https://securiteam.com/exploits/5ep0f0uquo/)
 - [Username Enumeration Vulnerabilities](https://www.gnucitizen.org/blog/username-enumeration-vulnerabilities/)
